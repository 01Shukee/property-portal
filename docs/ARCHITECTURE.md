# Property Management Portal - Code Architecture

## ğŸ—ï¸ Architecture Overview

This project follows a **client-server architecture** with a clear separation of concerns:

- **Frontend**: React SPA (Single Page Application)
- **Backend**: RESTful API built with Express.js
- **Database**: MongoDB (NoSQL document database)
- **Authentication**: JWT (JSON Web Tokens)

## ğŸ“ Detailed File Structure

### Backend Architecture

```
backend/
â”œâ”€â”€ config/
â”‚   â””â”€â”€ database.js          # MongoDB connection logic
â”‚
â”œâ”€â”€ models/
â”‚   â””â”€â”€ User.js              # User schema and methods
â”‚
â”œâ”€â”€ routes/
â”‚   â””â”€â”€ auth.js              # Authentication routes (register, login, profile)
â”‚
â”œâ”€â”€ middleware/
â”‚   â”œâ”€â”€ auth.js              # JWT verification and role authorization
â”‚   â””â”€â”€ errorHandler.js      # Centralized error handling
â”‚
â”œâ”€â”€ utils/
â”‚   â””â”€â”€ jwt.js               # Token generation and verification
â”‚
â”œâ”€â”€ server.js                # Main application entry point
â”œâ”€â”€ package.json             # Dependencies and scripts
â””â”€â”€ .env                     # Environment variables (not in repo)
```

### Frontend Architecture

```
frontend/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ components/          # Reusable UI components (to be built)
â”‚   â”‚
â”‚   â”œâ”€â”€ pages/
â”‚   â”‚   â”œâ”€â”€ LandingPage.js   # Public landing page
â”‚   â”‚   â”œâ”€â”€ LoginPage.js     # Login form
â”‚   â”‚   â”œâ”€â”€ RegisterPage.js  # Registration with role selection
â”‚   â”‚   â””â”€â”€ DashboardPage.js # Protected dashboard
â”‚   â”‚
â”‚   â”œâ”€â”€ services/
â”‚   â”‚   â””â”€â”€ api.js           # Axios instance and API calls
â”‚   â”‚
â”‚   â”œâ”€â”€ context/
â”‚   â”‚   â””â”€â”€ AuthContext.js   # Global authentication state
â”‚   â”‚
â”‚   â”œâ”€â”€ App.js               # Main component with routing
â”‚   â”œâ”€â”€ index.js             # React DOM entry point
â”‚   â””â”€â”€ index.css            # Tailwind CSS and custom styles
â”‚
â”œâ”€â”€ public/
â”‚   â””â”€â”€ index.html           # HTML template
â”‚
â”œâ”€â”€ tailwind.config.js       # Tailwind customization
â””â”€â”€ package.json             # Dependencies and scripts
```

## ğŸ” Authentication Flow

### Registration Flow

```
1. User fills registration form â†’ RegisterPage.js
2. Form data sent to â†’ AuthContext.register()
3. API call made to â†’ POST /api/auth/register
4. Backend processes:
   - Validates input
   - Checks if email exists
   - Hashes password (bcrypt)
   - Creates user in database
   - Generates JWT token
5. Response sent back with:
   - Token
   - User profile (without password)
6. Frontend:
   - Stores token in localStorage
   - Updates AuthContext
   - Redirects to dashboard
```

### Login Flow

```
1. User enters credentials â†’ LoginPage.js
2. Credentials sent to â†’ AuthContext.login()
3. API call made to â†’ POST /api/auth/login
4. Backend:
   - Finds user by email
   - Compares password hash
   - Generates JWT token if valid
5. Response with token and user
6. Frontend:
   - Stores token in localStorage
   - Updates AuthContext
   - Redirects to dashboard
```

### Protected Route Access

```
1. User visits protected route â†’ e.g., /dashboard
2. ProtectedRoute component checks:
   - Is there a token in localStorage?
   - Is user state populated in AuthContext?
3. If yes â†’ Render protected page
4. If no â†’ Redirect to /login
```

### API Request with Authentication

```
1. User makes authenticated request
2. Axios interceptor adds token:
   Headers: { Authorization: 'Bearer <token>' }
3. Backend middleware (protect):
   - Extracts token from header
   - Verifies token with JWT
   - Fetches user from database
   - Attaches user to request
4. Route handler has access to req.user
```

## ğŸ—„ï¸ Database Schema

### User Model

```javascript
{
  _id: ObjectId,              // Auto-generated by MongoDB
  name: String,               // Required
  email: String,              // Required, unique, validated
  phone: String,              // Required
  password: String,           // Required, hashed, not returned in queries
  role: String,               // 'property_manager' | 'homeowner' | 'tenant'
  address: String,            // Optional
  isActive: Boolean,          // Default: true
  createdAt: Date,            // Auto-generated
  updatedAt: Date             // Auto-updated
}
```

## ğŸ¨ Frontend State Management

### AuthContext Structure

```javascript
{
  user: {                     // Current logged-in user
    _id, name, email, phone, role, address, isActive, createdAt
  } | null,
  
  loading: Boolean,           // Initial auth check loading
  error: String | null,       // Error messages
  
  // Methods
  register: (userData) => Promise,
  login: (credentials) => Promise,
  logout: () => void,
  updateUser: (user) => void,
  
  // Computed properties
  isAuthenticated: Boolean,
  isPropertyManager: Boolean,
  isHomeowner: Boolean,
  isTenant: Boolean
}
```

## ğŸ›£ï¸ API Routes

### Authentication Routes

| Method | Endpoint | Auth | Description |
|--------|----------|------|-------------|
| POST | /api/auth/register | No | Register new user |
| POST | /api/auth/login | No | Login user |
| GET | /api/auth/me | Yes | Get current user |
| PUT | /api/auth/update-profile | Yes | Update user profile |
| PUT | /api/auth/change-password | Yes | Change password |

### Future Routes (To be implemented)

| Resource | Methods | Description |
|----------|---------|-------------|
| /api/properties | GET, POST, PUT, DELETE | Property CRUD |
| /api/leases | GET, POST, PUT, DELETE | Lease management |
| /api/payments | GET, POST, PUT | Payment tracking |
| /api/maintenance | GET, POST, PUT | Maintenance requests |
| /api/applications | GET, POST, PUT | Tenant applications |
| /api/announcements | GET, POST | Announcements |

## ğŸ”’ Security Features

### Password Security
- Passwords hashed with bcrypt (10 salt rounds)
- Never stored or transmitted in plain text
- Password field excluded from database queries by default

### JWT Security
- Tokens signed with secret key from environment
- Expiration time set (default 30 days)
- Tokens verified on every protected route

### Input Validation
- Email format validation
- Password minimum length (6 characters)
- Role validation (must be one of three types)
- Mongoose schema validation

### CORS Configuration
- Only specified frontend URL allowed
- Credentials enabled for cookie support
- Configurable via environment variable

## ğŸ¯ Design Patterns Used

### Backend Patterns

1. **MVC Pattern** (Modified)
   - Models: Database schemas
   - Controllers: Route handlers
   - Views: JSON responses

2. **Middleware Pattern**
   - Authentication middleware
   - Error handling middleware
   - Request parsing middleware

3. **Repository Pattern**
   - Mongoose models abstract database operations

### Frontend Patterns

1. **Context API Pattern**
   - Global state management
   - Avoid prop drilling
   - Centralized auth logic

2. **Component Pattern**
   - Reusable UI components
   - Props for customization
   - Composition over inheritance

3. **Protected Route Pattern**
   - Higher-order component
   - Conditional rendering
   - Automatic redirects

## ğŸš€ Scalability Considerations

### Code Organization
- **Modular**: Each file has single responsibility
- **Reusable**: Utility functions, components, middleware
- **Maintainable**: Clear naming, consistent structure

### Database
- **Indexed fields**: Email (unique index)
- **Schema design**: Prepared for relationships
- **Validation**: At both schema and application level

### API Design
- **RESTful**: Standard HTTP methods and status codes
- **Versioned**: /api prefix for future API versions
- **Documented**: Clear routes and responses

### Frontend
- **Code splitting**: React Router for lazy loading (can be added)
- **Component reusability**: Shared components folder
- **State management**: Context API (can scale to Redux if needed)

## ğŸ“ Naming Conventions

### Backend
- **Files**: camelCase (e.g., `errorHandler.js`)
- **Routes**: kebab-case (e.g., `/api/auth/update-profile`)
- **Functions**: camelCase (e.g., `generateToken`)
- **Models**: PascalCase (e.g., `User`)

### Frontend
- **Components**: PascalCase (e.g., `LoginPage.js`)
- **Functions**: camelCase (e.g., `handleSubmit`)
- **CSS classes**: tailwind utility classes
- **Custom CSS**: kebab-case (e.g., `.btn-primary`)

## ğŸ”„ Data Flow

### Complete Request-Response Cycle

```
User Action (Frontend)
    â†“
React Component
    â†“
Context/Service Layer
    â†“
API Call (Axios)
    â†“
Express Route Handler (Backend)
    â†“
Middleware (Auth, Validation)
    â†“
Controller Logic
    â†“
MongoDB Query (Mongoose)
    â†“
Database Response
    â†“
JSON Response (Backend)
    â†“
Promise Resolution (Frontend)
    â†“
State Update (Context)
    â†“
UI Re-render (React)
    â†“
User Sees Result
```

## ğŸ¨ Styling Architecture

### Tailwind CSS
- **Utility-first**: Compose styles with utility classes
- **Custom theme**: Extended colors, fonts, animations
- **Component classes**: Created with @layer directive
- **Responsive**: Mobile-first breakpoints

### Custom Classes
- `.btn`: Base button styles
- `.btn-primary`: Primary button variant
- `.card`: Card component
- `.input`: Form input
- `.badge`: Status badges

## ğŸ§ª Testing Strategy (To Implement)

### Backend Testing
- **Unit tests**: Individual functions
- **Integration tests**: API endpoints
- **Tools**: Jest, Supertest

### Frontend Testing
- **Component tests**: React Testing Library
- **E2E tests**: Cypress
- **Tools**: Jest, React Testing Library

## ğŸ“Š Performance Optimization

### Backend
- Connection pooling (Mongoose default)
- Efficient queries (select specific fields)
- Error handling (prevent crashes)

### Frontend
- Code splitting (React.lazy - to implement)
- Image optimization
- Bundle size optimization
- Caching strategies

## ğŸ”§ Environment Configuration

### Development
- Auto-reload (nodemon, React hot reload)
- Detailed error messages
- Source maps
- MongoDB local or Atlas

### Production (To configure)
- Minified bundles
- Environment-specific configs
- Error logging service
- CDN for static assets
- MongoDB Atlas
- Separate secrets

This architecture is designed to be:
- âœ… Easy to understand
- âœ… Easy to scale
- âœ… Easy to maintain
- âœ… Production-ready
